<!-- conversation-text.component.html -->
@for(message of messages(); track message.id; let i = $index;) {
  @if(message.role === 'user') {
    <ion-row [id]="message.id">
      <ion-col>
        <app-user-message [message]="message"></app-user-message>
      </ion-col>
    </ion-row>
  } @else {
    <ion-row class="assistant-response-row">
      <ion-col size="12">
        <div class="assistant-message" [@fadeInOut]>
          <!-- Show reasoning toggle button if reasoning is available -->
          @if(hasReasoning(message)) {
            <ion-button size="small" (click)="toggleReasoning()" fill="clear">
              <ion-icon slot="start" name="reader-outline"></ion-icon>
              {{ showReasoning ? 'Hide Reasoning' : 'Show Reasoning' }}
            </ion-button>
          }
          
          <!-- Show reasoning if available and user has toggled it -->
          @if(hasReasoning(message) && showReasoning) {
            <div class="reasoning-container">
              <h4>AI Reasoning Process</h4>
              <div class="reasoning-content">{{ message.reasoning }}</div>
            </div>
          }
          
          <!-- Show tool status if a tool is being used -->
          @if(isToolActive(message)) {
            <app-tool-status 
              [toolName]="message.toolStatus?.name || ''" 
              [toolInput]="message.toolStatus?.input">
            </app-tool-status>
          }
          
          <!-- Render assistant's text content -->
          <markdown clipboard mermaid [data]="getTextContent(message.content)"></markdown>
          
          <!-- Render tool use blocks if available -->
          @for(toolUseBlock of getToolUseBlocks(message.content); track toolUseBlock.toolUse.toolUseId) {
            <div class="tool-use-block">
              <ion-badge color="tertiary">Using Tool: {{ toolUseBlock.toolUse.name }}</ion-badge>
            </div>
          }
          
          <!-- Render tool results if available -->
          @if(message.toolResults && message.toolResults.length > 0) {
            @for(toolResult of message.toolResults; track toolResult.toolUseId) {
              <app-tool-result [toolResult]="toolResult"></app-tool-result>
            }
          }
        </div>
      </ion-col>
    </ion-row>
  }
  
  @if(loading() && isLastMessage(i)) {
    <ion-row class="metadata-row">
      <ion-col>
        <ion-chip [@fadeInOut]>
          <ion-avatar>
            <div class="pulsating-circle"></div>
          </ion-avatar>
          <ion-label>AI is thinking...</ion-label>
        </ion-chip>
      </ion-col>
    </ion-row>
  }
}